<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RocksDB Doxygen: tools/advisor 디렉토리 참조</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RocksDB Doxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 다음에 의해 생성됨 :  Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','검색',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_b2ea55d115167396574e66fe944d853b.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">로딩중...</div>
<div class="SRStatus" id="Searching">검색중...</div>
<div class="SRStatus" id="NoMatches">일치하는것 없음</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">advisor 디렉토리 참조</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
advisor에 대한 디렉토리 의존성 그래프:</div>
<div class="dyncontent">
<div class="center"><img src="dir_b2ea55d115167396574e66fe944d853b_dep.png" border="0" usemap="#adir__b2ea55d115167396574e66fe944d853b__dep" alt="tools/advisor"/></div>
<map name="adir__b2ea55d115167396574e66fe944d853b__dep" id="adir__b2ea55d115167396574e66fe944d853b__dep">
<area shape="rect" href="dir_8dcb2fdd79ebee23e50e5ad2f2c103ad.html" title="advisor" alt="" coords="131,65,200,93"/>
<area shape="rect" href="dir_74b037922f9e88616bfcee672dea2f00.html" title="test" alt="" coords="224,65,270,93"/>
<area shape="rect" href="dir_b2ea55d115167396574e66fe944d853b.html" alt="" coords="27,54,280,103"/>
<area shape="rect" href="dir_4eeb864c4eec08c7d6b9d3b0352cfdde.html" title="tools" alt="" coords="16,16,291,114"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="subdirs" name="subdirs"></a>
디렉토리들</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_8dcb2fdd79ebee23e50e5ad2f2c103ad.html">advisor</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_74b037922f9e88616bfcee672dea2f00.html">test</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">상세한 설명</h2>
<h1><a class="anchor" id="autotoc_md71"></a>
Motivation</h1>
<p>The performance of Rocksdb is contingent on its tuning. However, because of the complexity of its underlying technology and a large number of configurable parameters, a good configuration is sometimes hard to obtain. The aim of the python command-line tool, Rocksdb Advisor, is to automate the process of suggesting improvements in the configuration based on advice from Rocksdb experts.</p>
<h1><a class="anchor" id="autotoc_md72"></a>
Overview</h1>
<p>Experts share their wisdom as rules comprising of conditions and suggestions in the INI format (refer <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rules.ini">rules.ini</a>). Users provide the Rocksdb configuration that they want to improve upon (as the familiar Rocksdb OPTIONS file — <a href="https://github.com/facebook/rocksdb/blob/main/examples/rocksdb_option_file_example.ini">example</a>) and the path of the file which contains Rocksdb logs and statistics. The <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rule_parser_example.py">Advisor</a> creates appropriate DataSource objects (for Rocksdb <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/db_log_parser.py">logs</a>, <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/db_options_parser.py">options</a>, <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/db_stats_fetcher.py">statistics</a> etc.) and provides them to the <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rule_parser.py">Rules Engine</a>. The Rules uses rules from experts to parse data-sources and trigger appropriate rules. The Advisor's output gives information about which rules were triggered, why they were triggered and what each of them suggests. Each suggestion provided by a triggered rule advises some action on a Rocksdb configuration option, for example, increase CFOptions.write_buffer_size, set bloom_bits to 2 etc.</p>
<h1><a class="anchor" id="autotoc_md73"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md74"></a>
Prerequisites</h2>
<p>The tool needs the following to run:</p><ul>
<li>python3</li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
Running the tool</h2>
<p>An example command to run the tool:</p>
<div class="fragment"><div class="line">cd rocksdb/tools/advisor</div>
<div class="line">python3 -m advisor.rule_parser_example --rules_spec=advisor/rules.ini --rocksdb_options=test/input_files/OPTIONS-000005 --log_files_path_prefix=test/input_files/LOG-0 --stats_dump_period_sec=20</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md76"></a>
Command-line arguments</h2>
<p>Most important amongst all the input that the Advisor needs, are the rules spec and starting Rocksdb configuration. The configuration is provided as the familiar Rocksdb Options file (refer <a href="https://github.com/facebook/rocksdb/blob/main/examples/rocksdb_option_file_example.ini">example</a>). The Rules spec is written in the INI format (more details in <a href="https://github.com/facebook/rocksdb/blob/main/tools/advisor/advisor/rules.ini">rules.ini</a>).</p>
<p>In brief, a Rule is made of conditions and is triggered when all its constituent conditions are triggered. When triggered, a Rule suggests changes (increase/decrease/set to a suggested value) to certain Rocksdb options that aim to improve Rocksdb performance. Every Condition has a 'source' i.e. the data source that would be checked for triggering that condition. For example, a log Condition (with 'source=LOG') is triggered if a particular 'regex' is found in the Rocksdb LOG files. As of now the Rules Engine supports 3 types of Conditions (and consequently data-sources): LOG, OPTIONS, TIME_SERIES. The TIME_SERIES data can be sourced from the Rocksdb <a href="https://github.com/facebook/rocksdb/blob/main/include/rocksdb/statistics.h">statistics</a> or <a href="https://github.com/facebook/rocksdb/blob/main/include/rocksdb/perf_context.h">perf context</a>.</p>
<p>For more information about the remaining command-line arguments, run:</p>
<div class="fragment"><div class="line">cd rocksdb/tools/advisor</div>
<div class="line">python3 -m advisor.rule_parser_example --help</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
Sample output</h2>
<p>Here, a Rocksdb log-based rule has been triggered:</p>
<div class="fragment"><div class="line">Rule: stall-too-many-memtables</div>
<div class="line">LogCondition: stall-too-many-memtables regex: Stopping writes because we have \d+ immutable memtables \&zwj;(waiting for flush\&zwj;), max_write_buffer_number is set to \d+</div>
<div class="line">Suggestion: inc-bg-flush option : DBOptions.max_background_flushes action : increase suggested_values : [&#39;2&#39;]</div>
<div class="line">Suggestion: inc-write-buffer option : CFOptions.max_write_buffer_number action : increase</div>
<div class="line">scope: col_fam:</div>
<div class="line">{&#39;default&#39;}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md78"></a>
Running the tests</h1>
<p>Tests for the code have been added to the <a href="https://github.com/facebook/rocksdb/tree/main/tools/advisor/test">test/</a> directory. For example, to run the unit tests for <a class="el" href="d6/d35/db__log__parser_8py.html">db_log_parser.py</a>:</p>
<div class="fragment"><div class="line">cd rocksdb/tools/advisor</div>
<div class="line">python3 -m unittest -v test.test_db_log_parser</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_4eeb864c4eec08c7d6b9d3b0352cfdde.html">tools</a></li><li class="navelem"><a class="el" href="dir_b2ea55d115167396574e66fe944d853b.html">advisor</a></li>
    <li class="footer">다음에 의해 생성됨 :  <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
